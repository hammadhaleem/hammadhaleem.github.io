
<!doctype html>
<html lang="en">
	<head>
		<title>Stanford Bunny Simple</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<script type="text/javascript" src="http://oos.moxiecode.com/js_webgl/build_r58/three.min.js"></script>

		<script type="text/javascript" src="https://googlechrome.github.io/web-audio-samples/samples/audio/visualizer-gl/o3djs/base.js"></script>
		<script type="text/javascript" src="js/window.resize.js"></script>
		<script type="text/javascript" src="js/animation.js"></script>
	</head>

	<body>

		<script type="x-shader/x-vertex" id="vertexshader">

			attribute float time;
			attribute vec3 customColor;
			uniform vec3 effector;
			uniform vec3 effector2;
			uniform float globalTime;
			attribute float seed;
			attribute vec3 normals;

			varying vec3 vColor;
			varying vec3 vNormal;

			uniform float lightDistance;
			varying vec3 light0Color;
			varying vec3 light1Color;

			void main() {

				vColor = customColor;
				vNormal = normal;

				// time
				float localTime = time + globalTime;
				float modTime = mod( localTime, 1.0 );
				float accTime = modTime * modTime;

					vec3 dif = position - effector;
					float distance = dif.x * dif.x + dif.y * dif.y + dif.z * dif.z;
					float invDistance = max(0.0, 20.0-distance) / 15.0;
					vec3 dif2 = position - effector2;
					float distance2 = dif2.x * dif2.x + dif2.y * dif2.y + dif2.z * dif2.z;
					float invDistance2 = max(0.0, 20.0-distance2) / 15.0;

				vec3 animated = position;
				float s = abs( sin((localTime*50.0)+seed)*0.1 )+invDistance+invDistance2;
				animated +=  normals*s;

				vec4 mvPosition = modelViewMatrix * vec4( animated, 1.0 );
				gl_Position = projectionMatrix * mvPosition;


				// light 0
				vec3 transformedNormal = normalize(mvPosition.xyz);
				light0Color = vec3(0.7,0.7,0.7);

				vec4 lPosition = viewMatrix * vec4( effector, 1.0 );
				vec3 lVector = lPosition.xyz - mvPosition.xyz;

				float lDistance = 1.0;
				lDistance = 1.0 - min( ( length( lVector ) / lightDistance ), 1.0 );

				light0Color += vec3(2.0,1.0,2.0) * lDistance;


				// light 1
				vec3 transformedNormal1 = normalize(mvPosition.xyz);

				light1Color = vec3(0.7,0.7,0.7);

				vec4 lPosition1 = viewMatrix * vec4( effector2, 1.0 );
				vec3 lVector1 = lPosition1.xyz - mvPosition.xyz;

				float lDistance1 = 1.0;
				lDistance1 = 1.0 - min( ( length( lVector1 ) / lightDistance ), 1.0 );

				light1Color += vec3(2.0,1.0,2.0) * lDistance1;

			}

		</script>

		<script type="x-shader/x-fragment" id="fragmentshader">

			uniform vec3 color;
			uniform vec3 light;

			varying vec3 vColor;
			varying vec3 vNormal;

			varying vec3 light0Color;
			varying vec3 light1Color;

			void main() {

				float depth = gl_FragCoord.z / gl_FragCoord.w;
				float near = 12.0;
				float far = 23.0;
				float depthcolor = 1.0 - smoothstep( near, far, depth );

				vec3 l = light;
				l = normalize(l);
				float d0 = max(0.25,dot(vNormal, l));

				gl_FragColor = vec4( color * vColor.xyz * d0 * light0Color * light1Color * depthcolor, 1.0 );

			}

		</script>

		<script>
			var analyserView1;
			var container;

			var camera, scene, renderer;

			var has_gl = false;

			var delta;
			var time;
			var oldTime;

			var con;

			var ball;
			var ball2;

			var attributes;
			var uniforms;

			init();
			animate();

		</script>

		<!-- Sliders and other controls will be added here -->
<div id="controls"> </div>

<!-- Analyser type -->
<input type="radio" name="radioSet" value="data" onMouseDown="analyserView1.setAnalysisType(ANALYSISTYPE_FREQUENCY);" />
Frequency
<input type="radio" name="radioSet" value="data" onMouseDown="analyserView1.setAnalysisType(ANALYSISTYPE_SONOGRAM);" />
Sonogram
<input type="radio" name="radioSet" value="data" checked="checked" onMouseDown="analyserView1.setAnalysisType(ANALYSISTYPE_3D_SONOGRAM);" />
3D Sonogram
<input type="radio" name="radioSet" value="data" onMouseDown="analyserView1.setAnalysisType(ANALYSISTYPE_WAVEFORM);"/>
Waveform

	</body>
</html>
